# media-normalizer

Media Normalizer — це утиліта для автоматичної перевірки та нормалізації відеофайлів
для коректного Direct Play у Jellyfin / Plex / браузерах.

Проєкт створений як практичне рішення для домашніх NAS та медіасерверів
(Raspberry Pi, mini-PC, сервери), де небажано або неможливо постійне перекодування
на льоту.


---------------------------------------------------------------------

ОСНОВНІ МОЖЛИВОСТІ

• Сканує вказану директорію з відео (включно з підпапками)
• Перевіряє відео- та аудіокодеки кожного файлу
• Якщо відео вже у цільовому кодеку — НЕ перекодовує відео
• Перекодовує лише аудіо (наприклад AC3 → AAC), якщо потрібно
• Збирає результат у контейнер MP4
• Підходить для Direct Play у Jellyfin та браузерах
• Працює в режимі демона (continuous) або разового запуску
• Може працювати повністю у Docker
• Обмежується 1–2 ядрами CPU (підходить для фону)


---------------------------------------------------------------------

ТИПОВА ПРОБЛЕМА, ЯКУ ВИРІШУЄ

• MKV файли не відкриваються у браузері
• Jellyfin постійно вмикає перекодування
• Звук є у локальному плеєрі, але відсутній у Direct Play
• AC3 / DTS не підтримуються клієнтами
• Не хочеться перекодовувати 1+ ТБ відео вручну

Media Normalizer автоматизує цей процес.


---------------------------------------------------------------------

ПРИНЦИП РОБОТИ

1. Сканування директорії з відео
2. Аналіз кодеків через ffprobe
3. Прийняття рішення:
   – Direct Play OK → файл пропускається
   – Несумісний аудіокодек → перекодується лише аудіо
   – Несумісний відеокодек → повне перекодування (опціонально)
4. Збірка фінального MP4
5. (Опційно) Видалення оригіналу або резервне копіювання


---------------------------------------------------------------------

ПІДТРИМУВАНІ ФОРМАТИ

Вхідні:
• mkv
• mp4
• avi

Вихідні:
• mp4 (H.264 / H.265 + AAC)


---------------------------------------------------------------------

КОНФІГУРАЦІЯ (config.yaml)

Основні параметри:

• source_path — директорія з відео
• mode — continuous або cron
• threads — кількість потоків
• video_codec — h264 або h265
• audio_codec — aac
• video_bitrate — по роздільній здатності
• audio_bitrate — наприклад 192k
• skip_small_files_mb — ігнорувати дрібні файли
• delete_backups — видаляти резервні копії


---------------------------------------------------------------------

ПРИКЛАД ЗАПУСКУ БЕЗ DOCKER

python main.py


---------------------------------------------------------------------

ЗАПУСК У DOCKER

docker build -t media-normalizer .
docker run -d \
  -v /path/to/videos:/videos \
  media-normalizer


---------------------------------------------------------------------

ДЛЯ КОГО ЦЕ

• Власники NAS
• Користувачі Jellyfin / Plex
• Ті, хто хоче Direct Play без лагів
• Ті, хто не хоче перекодовувати все вручну
• Любителі “поставив і забув”


---------------------------------------------------------------------

СТАТУС ПРОЄКТУ

Pet-project.
Робочий, використовується в реальному середовищі.
Код простий, без надмірної магії.
Відкритий до покращень і pull-request’ів.


---------------------------------------------------------------------

ЛІЦЕНЗІЯ

MIT

## Running in Docker

### Clone repository

    git clone https://github.com/MagestiUA/media-normalizer.git
    cd media-normalizer

---

### Build Docker image

    docker build -t media-normalizer:local .

---

### Configure volumes

Edit `docker-compose.yml` and mount your media directory:

    volumes:
      - /path/to/your/videos:/videos

Also make sure `config.yaml` points to the same path:

    source_path: "/videos"

---

### Start as background service (daemon)

    docker compose up -d

The container will:
- run in background
- automatically restart after system reboot
- continuously scan for new media files

---

### Check status

    docker compose ps
    docker logs -f media-normalizer

---

### Stop service

    docker compose down